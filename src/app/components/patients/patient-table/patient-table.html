<div class="mat-elevation-z8">
  <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>

  <table mat-table [dataSource]="dataSource" matSort class="patient-table">
    <!-- Patient ID Column -->
    <ng-container matColumnDef="patientID">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient ID</th>
      <td mat-cell *matCellDef="let patient">{{ patient.patientID }}</td>
    </ng-container>

    <!-- User ID Column -->
    <ng-container matColumnDef="userID">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>User ID</th>
      <td mat-cell *matCellDef="let patient">{{ patient.userID }}</td>
    </ng-container>

    <!-- First Name Column -->
    <ng-container matColumnDef="firstName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
      <td mat-cell *matCellDef="let patient">{{ patient.firstName }}</td>
    </ng-container>

    <!-- Last Name Column -->
    <ng-container matColumnDef="lastName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
      <td mat-cell *matCellDef="let patient">{{ patient.lastName }}</td>
    </ng-container>

    <!-- Date of Birth Column -->
    <ng-container matColumnDef="dateOfBirth">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Date of Birth</th>
      <td mat-cell *matCellDef="let patient">{{ patient.dateOfBirth | date:'mediumDate' }}</td>
    </ng-container>

    <!-- Gender Column -->
    <ng-container matColumnDef="gender">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Gender</th>
      <td mat-cell *matCellDef="let patient">{{ patient.gender }}</td>
    </ng-container>

    <!-- Contact Number Column -->
    <ng-container matColumnDef="contactNumber">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Contact Number</th>
      <td mat-cell *matCellDef="let patient">{{ patient.contactNumber }}</td>
    </ng-container>

    <!-- Address Column -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Address</th>
      <td mat-cell *matCellDef="let patient">{{ patient.address }}</td>
    </ng-container>

    <!-- Medical History Column -->
    <ng-container matColumnDef="medicalHistory">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Medical History</th>
      <td mat-cell *matCellDef="let patient">
        <span [title]="patient.medicalHistory" class="truncate-text">
          {{ patient.medicalHistory || 'None' }}
        </span>
      </td>
    </ng-container>

    <!-- Allergies Column -->
    <ng-container matColumnDef="allergies">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Allergies</th>
      <td mat-cell *matCellDef="let patient">
        <span [title]="patient.allergies" class="truncate-text">
          {{ patient.allergies || 'None' }}
        </span>
      </td>
    </ng-container>

    <!-- Current Medications Column -->
    <ng-container matColumnDef="currentMedications">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Current Medications</th>
      <td mat-cell *matCellDef="let patient">
        <span [title]="patient.currentMedications" class="truncate-text">
          {{ patient.currentMedications || 'None' }}
        </span>
      </td>
    </ng-container>

    <!-- Created Date Column -->
    <ng-container matColumnDef="createdat">
     <th mat-header-cell *matHeaderCellDef mat-sort-header>Created At</th>
     <td mat-cell *matCellDef="let patient">
       <span [title]="patient.createdat" class="truncate-text">
         {{ patient.createdat }}
       </span>
     </td>
    </ng-container>

    <!-- Modified Date Column -->
    <ng-container matColumnDef="modifiedat">
     <th mat-header-cell *matHeaderCellDef mat-sort-header>Modified At</th>
     <td mat-cell *matCellDef="let patient">
       <span [title]="patient.modifiedat" class="truncate-text">
         {{ patient.modifiedat}}
       </span>
     </td>
    </ng-container>

    <ng-container matColumnDef="isactive">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>isActive</th>
      <td mat-cell *matCellDef="let patient">
        <span [title]="patient.isactive" class="truncate-text">
          {{patient.isactive}}
        </span>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let patient">
        <button mat-icon-button color="primary" (click)="viewPatientDetails(patient.patientID)" title="View Details">
          <mat-icon>visibility</mat-icon>
        </button>
        <button mat-icon-button color="accent" (click)="editPatient(patient.patientID)" title="Edit Patient">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deletePatient(patient.patientID)" title="Delete Patient">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <!-- Empty state -->
    <tr *matNoDataRow>
      <td [attr.colspan]="displayedColumns.length" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <p>No patients found</p>
      </td>
    </tr>
  </table>

  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageIndex]="currentPage"
    [pageSizeOptions]="[5, 10, 20, 50]"
    (page)="onPageChange($event)"
    showFirstLastButtons
    aria-label="Select page of patients"
  ></mat-paginator>
</div>
